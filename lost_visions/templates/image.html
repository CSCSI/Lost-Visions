{% extends "base.html" %}


{% block content %}

    <script type="text/javascript" xmlns="http://www.w3.org/1999/html">
        function load_new_image() {
            myApp.showPleaseWait()
            console.log('here');
            var name = 'test';
            Dajaxice.lost_visions.new_image(Dajax.process,{'name': name});
        }

        function change_image(url){
            {#            $('#photo').attr("src", url);#}
            location.reload();
            myApp.hidePleaseWait();
        }

        function add_thank_you(){
            $('#right-main').empty();
            $('#right-main').load('{% url 'thank_you_url' %}');
        }


        function add_description(){
            $('#right-main').empty();
            $('#right-main').load('{% url 'free_text_description_url' %}', function() {
                $( "input[type=checkbox]" )
                        .button();
                $('#submit_free_text').click(function(){
                    Dajaxice.lost_visions.submit_free_text(
                            Dajax.process,{'form':$('#free-text-description-form').serialize(true), 'image_id':'{{image_id}}'})
                });
            });
        }

        function add_new_tags(){
            $('#right-main').empty();
            $('#right-main').load('{% url 'new_tags_url' %}', function() {

                $('#submit_new_tags').click(function(){
                    Dajaxice.lost_visions.submit_new_tags(
                            Dajax.process,{'form':$('#add-tag-form').serialize(true), 'image_id':'{{image_id}}'})
                });

                $('#add_tag').click(function(){

                    var input_field = $("#input_tag");
                    var tag_string = input_field.val();
                    if (tag_string != "") {
                        var id = 'id_' + tag_string;

                        var $check = $('<input/>').attr({type: 'checkbox', id: id, checked: true});
                        var $label = $('<label/>').attr({for: id}).html(tag_string);


                        $("#add-tag-panel-body").prepend($label).prepend($check);

                        $( "input[type=checkbox]" )
                                .button();
                    }
                    input_field.val("");
                });

                $( "input[type=checkbox]" )
                        .button();
            });
        }

        function add_creation_techniques(){
            $('#right-main').empty();
            $('#right-main').load('{% url 'creation_techniques_url' %}', function() {
                $( "input[type=checkbox]" )
                        .button();
                $('#submit_creation_techniques').click(function(){
                    Dajaxice.lost_visions.submit_creation_techniques(
                            Dajax.process,{'form':$('#creation-techniques-form').serialize(true), 'image_id':'{{image_id}}'})
                });
            });
        }

        function add_categories(){
            $('#right-main').empty();
            $('#right-main').load('{% url 'categories_url' %}', function() {
                $( "input[type=checkbox]" )
                        .button();
                $('#submit_categories').click(function(){
                    Dajaxice.lost_visions.submit_categories(
                            Dajax.process,{'form':$('#categories-form').serialize(true), 'image_id':'{{image_id}}'})
                });

            });
        }

        var myApp;
        myApp = myApp || (function () {
            var pleaseWaitDiv = $('<div class="modal hide" id="pleaseWaitDialog" data-backdrop="static" data-keyboard="false"><div class="modal-header"><h1>Processing...</h1></div><div class="modal-body"><div class="progress progress-striped active"><div class="bar" style="width: 100%;"></div></div></div></div>');
            return {
                showPleaseWait: function() {
                    pleaseWaitDiv.modal();
                },
                hidePleaseWait: function () {
                    pleaseWaitDiv.modal('hide');
                }
            }
        })();

        $(document).ready(function () {
            {#            $('#submit_button').click(function(){#}
            {#                Dajaxice.lost_visions.submit_tags(#}
            {#                        Dajax.process,{'form':$('#tags-form').serialize(true), 'image_id':'{{image_id}}'})#}
            {#            });#}
            {##}
            $('#load_new_image').click(function(){
                window.location.replace({% url 'image.random' %})
                {#                Dajaxice.lost_visions.load_image(Dajax.process,{})#}
            });

            $('#add_tag').click(function(){

                var input_field = $("#input_tag");
                var tag_string = input_field.val();
                if (tag_string != "") {
                    var id = 'id_' + tag_string;

                    var $check = $('<input/>').attr({type: 'checkbox', id: id, checked: true, name: tag_string});
                    var $label = $('<label/>').attr({for: id}).html(tag_string);


                    $("#add_tag_body").prepend($label).prepend($check);

                    $( "input[type=checkbox]" )
                            .button();
                }
                input_field.val("");
            });
        });
    </script>
    <style>
        .category-box{
        {#            height: 75px;#}
        {#        width: 100px;#}
            background-color: red;
            border: 2px;
            padding: 3px;
        }
        .next-click{
            height: 48px;
            width: 100px;
            background-color: darkslategray;
            border: 2px;
            padding: 3px;
            cursor: pointer;
            border-radius: 5px;
        }
        .lv_tags{
            background-color: darkslategray;
            border: 2px;
            padding: 3px;
            border-radius: 5px;
        }
    </style>

    <div class="container">

    <div class="col-xs-12 col-sm-6">
        <div class="jumbotron">
            <img id='photo' src="{{ image.imageurl }}" style='max-width:100%; height:auto'>
        </div>
    </div><!--/span-->

    <div class="col-xs-12 col-sm-6">

    <div class="container-fluid">

    <div id="right-main">


    <form action="{% url 'image.tags' %}" id="image-taggin-form" method="post">{% csrf_token %}
    {{ tag_form.non_field_errors }}

    <div class="panel-group" id="accordion">
    <div class="panel panel-default">
        <div class="panel-heading">
            <h4 class="panel-title">
                <a data-toggle="collapse" data-parent="#accordion" href="#collapseOne">
                    Please select the tags below which describe the image                                </a>
            </h4>
        </div>
        <div id="collapseOne" class="panel-collapse collapse in">
            <div class="panel-body">

                <script type="text/javascript">
                    d = new dTree('Categories');

                    category_array = categories.split('\n');

                    category_array.forEach(function(entry){

                        document.write(entry + '<br>');

                        entry_array = entry.split('>');

                        document.write(entry_array);

                        d.add(entry[1], entry[0], entry[2]);
                    });

                    document.write(d);

                </script>

            </div>
            <div class="panel-footer">
                <a data-toggle="collapse" data-parent="#accordion" href="#collapseTwo"
                   class="btn btn-default">Next →</a>
            </div>
        </div>

    </div>









    <div class="panel panel-default">
        <div class="panel-heading">
            <h4 class="panel-title">
                <a data-toggle="collapse" data-parent="#accordion" href="#collapseOne">
                    Please select the tags below which describe the image                                </a>
            </h4>
        </div>
        <div id="collapseOne" class="panel-collapse collapse in">
            <div class="panel-body">

                {% for key in image.tags %}
                    <input type="checkbox" value="{{ key }}" id="check{{ forloop.counter }}" />

                    <label for="check{{ forloop.counter }}">{{ key }}</label>
                {% empty %}
                    <p>(No previous tags found for this image)</p>
                {% endfor %}



                <div class="panel-heading">Please select the Flickr tags below which describe the image</div>
                <div class="panel-body">
                    {% for field in tag_form %}
                        {{ field }}
                        <label for="{{ field.auto_id }}">{{ field.label }}</label>
                    {% empty %}
                        (No relevant Flickr tags found for this image)
                    {% endfor %}
                </div>

            </div>
            <div class="panel-footer">
                <a data-toggle="collapse" data-parent="#accordion" href="#collapseTwo"
                   class="btn btn-default">Next →</a>
            </div>
        </div>

    </div>



    <div class="panel panel-default">
        <div class="panel-heading">
            <h4 class="panel-title">
                <a data-toggle="collapse" data-parent="#accordion" href="#collapseTwo">
                    Please select one or more categories which describe the image
                </a>
            </h4>
        </div>
        <div id="collapseTwo" class="panel-collapse collapse">
            <div class="panel-body">


                <div id="categories" class="row-fluid">
                    {% for field in category_form %}
                        {{ field }}
                        <label for="{{ field.auto_id }}">{{ field.label }}</label>

                    {% endfor %}
                </div>

            </div>
            <div class="panel-footer">
                <a data-toggle="collapse" data-parent="#accordion" href="#collapseOne"
                   class="btn btn-default">← Previous</a>
                <a data-toggle="collapse" data-parent="#accordion" href="#collapseThree"
                   class="btn btn-default">Next →</a>
            </div>
        </div>

    </div>




    <div class="panel panel-default">
        <div class="panel-heading">
            <h4 class="panel-title">
                <a data-toggle="collapse" data-parent="#accordion" href="#collapseThree">
                    Please enter a new tag to describe the image
                </a>
            </h4>
        </div>
        <div id="collapseThree" class="panel-collapse collapse">
            <div class="panel-body">

                <div id="add_tag_body">

                </div>

                <div id="free_text" >
                    <label for="input_tag">Tag</label>
                    <input type="text" class="form-control" id="input_tag">
                    <div id="add_tag" class="btn btn-default">Add</div>
                </div>


            </div>
            <div class="panel-footer">
                <a data-toggle="collapse" data-parent="#accordion" href="#collapseTwo"
                   class="btn btn-default">← Previous</a>
                <a data-toggle="collapse" data-parent="#accordion" href="#collapseFour"
                   class="btn btn-default">Next →</a>
            </div>
        </div>
    </div>




    <div class="panel panel-default">
        <div class="panel-heading">
            <h4 class="panel-title">
                <a data-toggle="collapse" data-parent="#accordion" href="#collapseFour">
                    Please select one or more creation techniques which are relevant to the image
                </a>
            </h4>
        </div>
        <div id="collapseFour" class="panel-collapse collapse">
            <div class="panel-body">


                <div class="row-fluid">

                    {% for field in create_tech_form %}
                        {{ field }}
                        <label for="{{ field.auto_id }}">{{ field.label }}</label>

                    {% endfor %}

                </div>

            </div>
            <div class="panel-footer">
                <a data-toggle="collapse" data-parent="#accordion" href="#collapseThree"
                   class="btn btn-default">← Previous</a>
                <a data-toggle="collapse" data-parent="#accordion" href="#collapseFive"
                   class="btn btn-default">Next →</a>
            </div>
        </div>
    </div>




    <div class="panel panel-default">
        <div class="panel-heading">
            <h4 class="panel-title">
                <a data-toggle="collapse" data-parent="#accordion" href="#collapseFive">
                    Please enter a description of the image                                </a>
            </h4>
        </div>
        <div id="collapseFive" class="panel-collapse collapse">
            <div class="panel-body">

                <div id="free_text" class="row-fluid">
                    <label for="free-text-area">Description</label>
                    <textarea name="image_description" class="form-control"
                              rows="3" id="free-text-area"></textarea>
                </div>
            </div>

            <div class="panel-footer">
                <a data-toggle="collapse" data-parent="#accordion" href="#collapseFour"
                   class="btn btn-default">← Previous</a>
                <button type="submit" class="btn btn-primary">Finish!</button>
            </div>
        </div>
    </div>

    </div>

    </form>

    </div>
    </div>
    <hr>
    <div id="load_new_image" class="btn btn-info btn-lg">
        <a href="{% url 'image.random' %}">New Image</a>
    </div>

    {#            <div id="load_new_image" class="btn btn-info btn-lg">New Image</div>#}
    </div>

    </div>
    <hr>

    <div class="container">
        <div class="col-xs-12 col-sm-6">
            <div class="bs-example table-responsive">
                <table class="table table-striped table-hover ">
                    <tbody>
                    {% for mykey,value in image.items %}
                        {% if mykey != 'tags' %}

                            <tr><th>{{ mykey }}</th><td>{{ value }}</td></tr>

                        {% endif %}
                    {% endfor %}
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <div>
        <table style="margin-top: 1em;">
            <thead>
            <tr>
                <th colspan="2" style="font-size: 110%; font-weight: bold; text-align: left; padding-left: 0.1em;">
                    Coordinates
                </th>
                <th colspan="2" style="font-size: 110%; font-weight: bold; text-align: left; padding-left: 0.1em;">
                    Dimensions
                </th>
            </tr>
            </thead>
            <tbody>
            <tr>
                <td style="width: 10%;"><b>X<sub>1</sub>:</b></td>
                <td style="width: 30%;"><input type="text" id="x1" value="-" /></td>
                <td style="width: 20%;"><b>Width:</b></td>
                <td><input type="text" value="-" id="w" /></td>
            </tr>
            <tr>
                <td><b>Y<sub>1</sub>:</b></td>
                <td><input type="text" id="y1" value="-" /></td>
                <td><b>Height:</b></td>
                <td><input type="text" id="h" value="-" /></td>
            </tr>
            <tr>
                <td><b>X<sub>2</sub>:</b></td>
                <td><input type="text" id="x2" value="-" /></td>
                <td></td>
                <td></td>
            </tr>
            <tr>
                <td><b>Y<sub>2</sub>:</b></td>
                <td><input type="text" id="y2" value="-" /></td>
                <td></td>
                <td></td>
            </tr>
            </tbody>
        </table>
    </div>
    <div class="container">
        <div id="preview" style="width: 100px; height: 100px; overflow: hidden;">
            <img src="{{ image.imageurl }}"/>
        </div>
    </div>


{% endblock %}